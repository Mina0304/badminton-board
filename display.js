/* ğŸ”´ æ”¹æˆä½ å¯¦éš›åœ¨ç”¨çš„ Apps Script /exec */
const API_URL =
  "https://script.google.com/macros/s/AKfycbyg_h0KqcPVuojAXTJROQ8Zg6x-mXHsYceYGUbyDzYVhWnwtPWZ72L0jtuuhMXcG_2mcg/exec";

/* å…§å»ºè³½ç¨‹ï¼ˆæ¯”è³½åç¨±ï¼‰ */
const SCHEDULES = {
  "2026-02-07": {
    court1:["ç”·åœ˜1","ç”·åœ˜7","ç”·é›™1","ç”·é›™7","å¥³é›™2","ç”·å–®1","ç”·å–®7","å¥³å–®4","ç”·é›™17","ç”·å–®10","å¥³é›™9","ç”·åœ˜8","ç”·åœ˜14","ç”·é›™23","ç”·é›™29","å¥³é›™16","ç”·é›™34","ç”·åœ˜15"],
    court2:["ç”·åœ˜2","å¥³åœ˜1","ç”·é›™2","ç”·é›™8","å¥³é›™3","ç”·å–®2","ç”·å–®8","ç”·é›™12","ç”·é›™18","ç”·å–®11","å¥³é›™10","ç”·åœ˜9","å¥³åœ˜6","ç”·é›™24","ç”·é›™30","å¥³é›™17","ç”·é›™35","ç”·åœ˜16"],
    court3:["ç”·åœ˜3","å¥³åœ˜2","ç”·é›™3","ç”·é›™9","å¥³é›™4","ç”·å–®3","ç”·å–®9","ç”·é›™13","ç”·é›™19","ç”·å–®12","å¥³é›™11","ç”·åœ˜10","å¥³åœ˜7","ç”·é›™25","ç”·é›™31","å¥³é›™18","ç”·é›™36","ç”·åœ˜17"],
    court4:["ç”·åœ˜4","å¥³åœ˜3","ç”·é›™4","ç”·é›™10","å¥³é›™5","ç”·å–®4","å¥³å–®1","ç”·é›™14","ç”·é›™20","ç”·å–®13","å¥³é›™12","ç”·åœ˜11","å¥³åœ˜8","ç”·é›™26","ç”·é›™32","å¥³é›™19","ç”·é›™37","ç”·åœ˜18"],
    court5:["ç”·åœ˜5","å¥³åœ˜4","ç”·é›™5","ç”·é›™11","å¥³é›™6","ç”·å–®5","å¥³å–®2","ç”·é›™15","ç”·é›™21","ç”·å–®14","å¥³é›™13","ç”·åœ˜12","å¥³åœ˜9","ç”·é›™27","ç”·é›™33","å¥³é›™20","ç”·é›™38","ç”·åœ˜19"],
    court6:["ç”·åœ˜6","å¥³åœ˜5","ç”·é›™6","å¥³é›™1","å¥³é›™7","ç”·å–®6","å¥³å–®3","ç”·é›™16","ç”·é›™22","å¥³é›™8","å¥³é›™14","ç”·åœ˜13","å¥³åœ˜10","ç”·é›™28","å¥³é›™15","å¥³é›™21","ç”·é›™39","ç”·åœ˜20"]
  },
  "2026-02-08": {
    court1:["ç”·åœ˜21","ç”·å–®15","ç”·å–®21","ç”·å–®23","å¥³é›™23","å¥³å–®11","ç”·å–®32","ç”·åœ˜22","å¥³é›™30","ç”·é›™39","ç”·é›™45","ç”·åœ˜26","ç”·å–®39","ç”·åœ˜30","ç”·åœ˜32"],
    court2:["å¥³åœ˜11","ç”·å–®16","ç”·å–®22","ç”·å–®24","å¥³é›™24","å¥³å–®12","ç”·å–®33","ç”·åœ˜23","å¥³é›™31","ç”·é›™40","ç”·é›™46","ç”·åœ˜27","å¥³å–®17","ç”·åœ˜31","ç”·é›™54","ç”·åœ˜33","ç”·é›™55","ç”·å–®43"],
    court3:["å¥³åœ˜12","ç”·å–®17","å¥³å–®5","ç”·å–®25","å¥³é›™25","ç”·å–®28","ç”·å–®34","ç”·åœ˜24","å¥³å–®13","ç”·é›™41","ç”·é›™47","ç”·åœ˜28","å¥³å–®18","å¥³åœ˜20"],
    court4:["å¥³åœ˜13","ç”·å–®18","å¥³å–®6","ç”·å–®26","å¥³é›™26","ç”·å–®29","ç”·å–®35","ç”·åœ˜25","å¥³å–®14","ç”·é›™42","ç”·å–®36","ç”·åœ˜29","ç”·é›™48","ç”·é›™51","ç”·å–®40","å¥³å–®19","ç”·é›™52"],
    court5:["å¥³åœ˜14","ç”·å–®19","å¥³å–®7","ç”·å–®27","å¥³å–®9","ç”·å–®30","å¥³é›™28","å¥³åœ˜16","å¥³å–®15","ç”·é›™43","ç”·å–®37","å¥³åœ˜18","ç”·é›™49","å¥³é›™32","ç”·å–®41","ç”·é›™53","å¥³é›™34","å¥³åœ˜21","å¥³å–®20"],
    court6:["å¥³åœ˜15","ç”·å–®20","å¥³å–®8","å¥³é›™22","å¥³å–®10","ç”·å–®31","å¥³é›™29","å¥³åœ˜17","å¥³å–®16","ç”·é›™44","ç”·å–®38","å¥³åœ˜19","ç”·é›™50","å¥³é›™33","å¥³å–®19","ç”·å–®42"]
  }
};

/* æ—¥æœŸæ­£è¦åŒ– */
function normalizeDate(v){
  if(!v) return null;
  let s = String(v).trim();
  if(s.includes("T")) s = s.split("T")[0];
  s = s.replace(/\//g,"-");

  if(/^\d{1,2}-\d{1,2}$/.test(s)){
    const [m,d]=s.split("-").map(x=>x.padStart(2,"0"));
    return `2026-${m}-${d}`;
  }
  const m = s.match(/^(\d{4})-(\d{1,2})-(\d{1,2})$/);
  if(m) return `${m[1]}-${m[2].padStart(2,"0")}-${m[3].padStart(2,"0")}`;
  return null;
}

/* JSONP è®€å– */
function loadJSONP(){
  return new Promise((resolve,reject)=>{
    const cb="cb_"+Date.now()+"_"+Math.random().toString(36).slice(2);
    window[cb]=(p)=>{delete window[cb];script.remove();resolve(p);};
    const script=document.createElement("script");
    script.src=`${API_URL}?type=get&callback=${cb}&_=${Math.random()}`;
    script.onerror=()=>reject();
    document.body.appendChild(script);
  });
}

/* ç¹ªè£½ç•«é¢ */
function render(state){
  const host=document.getElementById("courts");
  host.innerHTML="";

  const dateIso = normalizeDate(state.date || state.day) || "2026-02-07";
  const day=SCHEDULES[dateIso]||SCHEDULES["2026-02-07"];

  for(let c=1;c<=6;c++){
    const idx=Number(state[`court${c}`]??0);
    const list=day[`court${c}`]||[];

    let now="â€”", next="â€”";
    if(state.status==="ä¸­å ´ä¼‘æ¯"){
      now = next = "ä¸­å ´ä¼‘æ¯";
    }else{
      now = list[idx] ?? "â€”";
      next = list[idx+1] ?? "â€”";
    }

    const card=document.createElement("div");
    card.className="card";
    card.innerHTML=`
      <div class="name">Court ${c}</div>
      <div class="now">ç¾åœ¨ï¼š${now}</div>
      <div class="next">ä¸‹ä¸€å ´ï¼š${next}</div>
    `;
    host.appendChild(card);
  }
}

/* æ¯ç§’åŒæ­¥ */
async function tick(){
  try{
    const p=await loadJSONP();
    if(p.ok) render(p.data||{});
  }catch(e){}
}

setInterval(tick,1000);
tick();
