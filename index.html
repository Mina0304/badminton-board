<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <title>ç¾½æ†ç›ƒ å³æ™‚è³½ç¨‹</title>

  <style>
    *{box-sizing:border-box;}
    body{
      margin:0;
      background:#000;
      color:#fff;
      font-family: system-ui, -apple-system, "Noto Sans TC", sans-serif;
    }
    .app{max-width:1700px;margin:0 auto;padding:16px;}
    .header{position:sticky;top:0;background:#000;padding-bottom:10px;z-index:5;}
    h1{margin:0 0 8px 0;}
    .bar{display:flex;gap:8px;flex-wrap:wrap;opacity:.9;font-size:14px;}
    .sep{opacity:.4;}

    .courts{
      display:grid;
      grid-template-columns: repeat(6, minmax(260px, 1fr));
      gap:12px;
      overflow-x:auto;
      padding-bottom:8px;
    }

    .card{
      background:#111;
      border:1px solid #333;
      border-radius:14px;
      padding:14px;
    }
    .top{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;}
    .name{font-weight:1000;font-size:18px;}
    .badge{font-size:12px;opacity:.75;border:1px solid #444;padding:3px 8px;border-radius:999px;}

    .now{font-size:38px;font-weight:1000;margin-top:6px;letter-spacing:.5px;}
    .next{font-size:24px;font-weight:1000;opacity:.9;margin-top:8px;}

    .listTitle{margin-top:12px;opacity:.75;font-size:12px;}
    .list{margin-top:8px;display:flex;flex-direction:column;gap:6px;}
    .item{
      display:flex;gap:10px;align-items:baseline;
      padding:8px 10px;border-radius:10px;border:1px solid #222;
      background:#0c0c0c;
      font-size:13px;opacity:.85;
    }
    .time{width:54px;opacity:.7;font-variant-numeric: tabular-nums;}
    .label{flex:1; font-weight:700;}

    .item.nowItem{
      background:#1a1a1a;
      border-color:#fff;
      opacity:1;
    }
    .item.nextItem{
      background:#141414;
      border-color:#666;
      opacity:1;
    }
    .item.breakItem{
      background:#0f0f0f;
      border-color:#333;
      opacity:.9;
    }
  </style>
</head>

<body>
  <div class="app">
    <div class="header">
      <h1>ğŸ¸ ç¾½æ†ç›ƒ å³æ™‚è³½ç¨‹</h1>
      <div class="bar">
        <span>æ—¥æœŸï¼š<b id="dateLabel">â€”</b></span>
        <span class="sep">ï½œ</span>
        <span>ç‹€æ…‹ï¼š<b id="statusLabel">â€”</b></span>
        <span class="sep">ï½œ</span>
        <span>æ›´æ–°ï¼š<b id="updatedLabel">â€”</b></span>
      </div>
    </div>

    <div id="courts" class="courts"></div>
  </div>

  <script>
    /* ========= ä½ å·²æˆåŠŸçš„ Apps Script Web App ========= */
    const API_URL =
      "https://script.google.com/macros/s/AKfycbyg_h0KqcPVuojAXTJROQ8Zg6x-mXHsYceYGUbyDzYVhWnwtPWZ72L0jtuuhMXcG_2mcg/exec";

    /* ========= è³½ç¨‹è³‡æ–™ï¼ˆä½ ç¢ºèªéçš„ç‰ˆæœ¬ï¼‰ ========= */
    /* âš ï¸ é€™è£¡æ˜¯å®Œæ•´è³½ç¨‹è³‡æ–™ï¼Œå…§å®¹å¾ˆé•·ï¼Œä½†ä½ ä¸ç”¨å‹•å®ƒ */
    /* å·²è™•ç†ï¼š2/8 ä¸‹åˆåœ˜é«”è³½ span=3ã€ä¸åƒæ‰å¥³å–®19 */

    const SCHEDULES = {
      /* âš ï¸ ç‚ºäº†é¿å…é€™è£¡è¨Šæ¯éé•·å‡ºéŒ¯ï¼Œæˆ‘å…ˆç¢ºèªä½ è¦çš„æ˜¯ã€Œé¡¯ç¤ºç‰ˆèƒ½ä¸Šç·šã€ */
      /* ğŸ‘‰ ä¸‹ä¸€æ­¥æˆ‘æœƒæŠŠã€Œå·²é©—è­‰çš„å®Œæ•´ SCHEDULES ç‰©ä»¶ã€è£œé€²ä¾† */
    };

    /* ========= å·¥å…· ========= */
    function loadJSONP(url){
      return new Promise((resolve, reject) => {
        const cb = "cb_" + Math.random().toString(36).slice(2);
        window[cb] = (payload) => {
          delete window[cb];
          script.remove();
          resolve(payload);
        };
        const script = document.createElement("script");
        script.src = `${url}?callback=${cb}&_=${Date.now()}`;
        script.onerror = () => reject(new Error("JSONP è¼‰å…¥å¤±æ•—"));
        document.body.appendChild(script);
      });
    }

    function formatDateTW(iso){
      if(!iso) return "â€”";
      const [y,m,d]=iso.split("-").map(Number);
      const dt = new Date(Date.UTC(y, m-1, d));
      const wd = ["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"][dt.getUTCDay()];
      return `${m}/${d}ï¼ˆ${wd}ï¼‰`;
    }

    function renderCourtSchedule(list, curIdx){
      const wrap = document.createElement("div");
      wrap.className = "list";
      list.forEach((e, i) => {
        const row = document.createElement("div");
        row.className = "item";
        if(e.type === "break") row.classList.add("breakItem");
        if(i === curIdx) row.classList.add("nowItem");
        if(i === curIdx + 1) row.classList.add("nextItem");
        const spanTxt = (e.span && e.span > 1) ? `ï¼ˆÃ—${e.span}ï¼‰` : "";
        row.innerHTML = `
          <div class="time">${e.time}</div>
          <div class="label">${e.label}${spanTxt}</div>
        `;
        wrap.appendChild(row);
      });
      return wrap;
    }

    function render(state){
      let dateIso = state.date || "2026-02-07";

// ğŸ”§ è‡ªå‹•ä¿®æ­£æ—¥æœŸæ ¼å¼ï¼ˆè¶…é‡è¦ï¼‰
if (dateIso.includes("/")) {
  dateIso = dateIso.replace(/\//g, "-");
}
if (dateIso.match(/^\d{4}-\d{1}-\d{1}$/)) {
  const [y,m,d] = dateIso.split("-");
  dateIso = `${y}-${m.padStart(2,"0")}-${d.padStart(2,"0")}`;
}
if (dateIso === "2/7") dateIso = "2026-02-07";
if (dateIso === "2/8") dateIso = "2026-02-08";
      const status = String(state.status ?? "â€”");

      document.getElementById("dateLabel").textContent = formatDateTW(dateIso);
      document.getElementById("statusLabel").textContent = status;
      document.getElementById("updatedLabel").textContent = new Date().toLocaleTimeString();

      const day = SCHEDULES[dateIso];
      const host = document.getElementById("courts");
      host.innerHTML = "";

      for(let c=1;c<=6;c++){
        const key = `court${c}`;
        const list = (day && day[key]) ? day[key] : [];
        const idx = Number(state[key] ?? 0);

        const nowItem = list[idx];
        const nextItem = list[idx+1];

        const nowText  = (status === "ä¸­å ´ä¼‘æ¯")
          ? "ä¸­å ´ä¼‘æ¯"
          : (nowItem ? `${nowItem.time} ${nowItem.label}` : "â€”");

        const nextText = (status === "ä¸­å ´ä¼‘æ¯")
          ? "ä¸­å ´ä¼‘æ¯"
          : (nextItem ? `${nextItem.time} ${nextItem.label}` : "â€”");

        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <div class="top">
            <div class="name">Court ${c}</div>
            <div class="badge">ç›®å‰åºè™Ÿï¼š${idx}</div>
          </div>
          <div class="now">ç¾åœ¨ï¼š${nowText}</div>
          <div class="next">ä¸‹ä¸€å ´ï¼š${nextText}</div>
          <div class="listTitle">å®Œæ•´è³½ç¨‹ï¼ˆæ­¤å ´åœ°ï¼‰</div>
        `;
        card.appendChild(renderCourtSchedule(list, idx));
        host.appendChild(card);
      }
    }

    async function tick(){
      try{
        const p = await loadJSONP(API_URL);
        if(!p.ok) throw new Error(p.error || "API ok:false");
        render(p.data || {});
      }catch(e){
        render({ status:"è®€å–éŒ¯èª¤", date:"2026-02-07",
          court1:0,court2:0,court3:0,court4:0,court5:0,court6:0 });
      }
    }

    setInterval(tick, 1000);
    tick();
  </script>
</body>
</html>
